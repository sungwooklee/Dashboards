{"title":"EC2 Right Sizing Overview_Kor","description":"https://docs.aws.amazon.com/whitepapers/latest/cost-optimization-right-sizing/tips-for-right-sizing-your-workloads.html\n\nAnalyze performance data to right size your EC2 instances. Identify idle instances and ones that are underutilized. Key metrics to look for are CPU usage and memory usage. Identify instances with a maximum CPU usage and memory usage of less than 40% over a four-week period. These are the instances that you will want to right size to reduce costs.\n\ndatadog_demo_keep:true","widgets":[{"id":0,"layout":{"x":65,"y":50,"width":36,"height":39},"definition":{"title":"Guideline: Maximum CPU usage < 40%","title_size":"16","title_align":"left","type":"query_table","requests":[{"formulas":[{"alias":"max cpu","conditional_formats":[{"palette":"white_on_red","comparator":"<","value":40},{"palette":"white_on_yellow","comparator":"<","value":60}],"limit":{"count":25,"order":"asc"},"formula":"query1"}],"response_format":"scalar","queries":[{"query":"max:aws.ec2.cpuutilization.maximum{$instance-type,$team,$aws_account} by {host,name}","data_source":"metrics","name":"query1","aggregator":"max"}]}]}},{"id":2,"layout":{"x":65,"y":30,"width":72,"height":19},"definition":{"title":"AWS Right Sizing Guideline: Maximum memory usage < 40% (lowest 50) (requires Datadog Agent)","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"1 - top(ewma_20(query1), 100, 'last', 'desc')"}],"response_format":"timeseries","queries":[{"query":"min:system.mem.pct_usable{$instance-type,$team,$aws_account} by {host}","data_source":"metrics","name":"query1"}],"style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[{"label":" 60 - 100 - ok ","value":"y > 0.6","display_type":"ok solid"},{"label":" < 60 - potential underutilzation ","value":"0.4 < y < 0.6","display_type":"warning solid"},{"label":" < 40 - needs right-sizing ","value":"0 < y < 0.4","display_type":"error solid"}]}},{"id":3,"layout":{"x":0,"y":10,"width":64,"height":79},"definition":{"title":"Underutilized Instances by both CPU and Memory (Top 50)","title_size":"16","title_align":"left","time":{},"type":"query_table","requests":[{"formulas":[{"alias":"max cpu","conditional_formats":[{"custom_fg_color":"#d56f6f","custom_bg_color":"#cc2a2a","comparator":"<","value":40,"palette":"white_on_red"},{"palette":"white_on_yellow","comparator":"<","value":60}],"formula":"query1"},{"alias":"min usable memory","conditional_formats":[{"palette":"white_on_red","comparator":">","value":0.6},{"palette":"white_on_yellow","comparator":">","value":0.4}],"formula":"query2","limit":{"count":500,"order":"desc"}}],"response_format":"scalar","queries":[{"query":"max:aws.ec2.cpuutilization.maximum{$instance-type,$team,$aws_account} by {name,instance-type}","data_source":"metrics","name":"query1","aggregator":"max"},{"query":"min:system.mem.pct_usable{$instance-type,$team,$aws_account} by {name,instance-type}","data_source":"metrics","name":"query2","aggregator":"min"}]}]}},{"id":4,"layout":{"x":65,"y":10,"width":72,"height":19},"definition":{"title":"AWS Right Sizing Guideline: Maximum CPU usage < 40% (Lowest 50)","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"top(query1, 50, 'last', 'asc')"}],"response_format":"timeseries","queries":[{"query":"max:aws.ec2.cpuutilization.maximum{$team,$instance-type,$aws_account} by {host}.rollup(60)","data_source":"metrics","name":"query1"}],"style":{"palette":"cool","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":false,"scale":"log"},"markers":[{"label":" 60 - 100 - ok ","value":"60 < y < 100","display_type":"ok solid"},{"label":" < 60 - potential underutilzation ","value":"40 < y < 60","display_type":"warning solid"},{"label":" < 40 - needs right-sizing ","value":"0 < y < 40","display_type":"error solid"}]}},{"id":5,"layout":{"x":102,"y":50,"width":35,"height":39},"definition":{"title":"Guideline: Maximum memory usage < 0.4","title_size":"16","title_align":"left","type":"query_table","requests":[{"formulas":[{"alias":"min usable memory","conditional_formats":[{"palette":"white_on_red","comparator":">","value":0.6},{"palette":"white_on_yellow","comparator":">","value":0.4}],"limit":{"count":25,"order":"desc"},"formula":"query1"}],"response_format":"scalar","queries":[{"query":"min:system.mem.pct_usable{$instance-type,$team,$aws_account} by {host,name}","data_source":"metrics","name":"query1","aggregator":"min"}]}]}},{"id":6,"layout":{"x":0,"y":0,"width":34,"height":9},"definition":{"type":"image","url":"https://datadog-docs.imgix.net/images/integrations_logos/amazon_ec2.png","sizing":"fit"}},{"id":7,"layout":{"x":35,"y":0,"width":29,"height":9},"definition":{"title":"EC2 Instances","title_size":"16","title_align":"left","type":"query_value","requests":[{"response_format":"scalar","queries":[{"query":"sum:aws.ec2.host_ok{$team,$instance-type,$aws_account}","data_source":"metrics","name":"query1","aggregator":"last"}]}],"custom_links":[],"precision":0}},{"id":10,"layout":{"x":65,"y":0,"width":36,"height":9},"definition":{"title":"Underutilized by CPU(30%미만 사용 계정별)","type":"treemap","requests":[{"formulas":[{"formula":"cutoff_max(query1, 30)"}],"response_format":"scalar","queries":[{"query":"max:aws.ec2.cpuutilization.maximum{$aws_account} by {account-alias,name}","data_source":"metrics","name":"query1","aggregator":"last"}]}]}},{"id":11,"layout":{"x":102,"y":0,"width":35,"height":9},"definition":{"title":"Underutilized by Mem(40%미만 사용 계정별)","type":"treemap","requests":[{"formulas":[{"formula":"cutoff_min(query1, 0.4)"}],"response_format":"scalar","queries":[{"query":"min:system.mem.pct_usable{$instance-type,$team,$aws_account} by {account-alias,name}","data_source":"metrics","name":"query1","aggregator":"last"}]}]}}],"template_variables":[{"name":"instance-type","prefix":"instance-type","available_values":[],"default":"*"},{"name":"team","prefix":"team","available_values":[],"default":"*"},{"name":"aws_account","prefix":"aws_account","available_values":[],"default":"*"}],"layout_type":"free","is_read_only":false,"notify_list":[],"id":"te5-5qj-jth"}