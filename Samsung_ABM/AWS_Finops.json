{"title":"'Create & Close' - AWS Finops","description":"datadog_demo_keep:true (cloned)","widgets":[{"id":7969973726183240,"definition":{"title":"Cost Overview","background_color":"vivid_pink","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":2817908103015702,"definition":{"title":"Customer(Weekly Active User)","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_value","requests":[{"formulas":[{"formula":"query1 * 20"}],"response_format":"scalar","queries":[{"name":"query1","data_source":"rum","search":{"query":"@type:session @application.id:75d50c62-8b66-403c-a453-aaa1c44d64bd @session.type:user"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"}],"conditional_formats":[{"comparator":">","value":0,"palette":"white_on_green"}]}],"autoscale":true,"precision":2},"layout":{"x":0,"y":0,"width":2,"height":2}},{"id":6366138493328564,"definition":{"title":"Customer(Monthly Trend)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"type":"live","unit":"month","value":1},"type":"timeseries","requests":[{"formulas":[{"formula":"query1 * 20"}],"queries":[{"name":"query1","data_source":"rum","search":{"query":"@type:session @application.id:75d50c62-8b66-403c-a453-aaa1c44d64bd @session.type:user"},"indexes":["*"],"group_by":[],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":2,"y":0,"width":10,"height":2}},{"id":5850489840183484,"definition":{"title":"Revenue","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_value","requests":[{"formulas":[{"formula":"(query2 / 300)"}],"queries":[{"data_source":"metrics","name":"query2","query":"sum:trace.rack.request.hits{resource_name:shoppingcartcontroller_checkout}.as_count()","aggregator":"sum"}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":0,"palette":"white_on_green"}]}],"autoscale":true,"precision":0},"layout":{"x":0,"y":2,"width":2,"height":2}},{"id":2658695725853548,"definition":{"title":"Revenue and Cloud Cost Spending","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"type":"live","unit":"month","value":1},"type":"timeseries","requests":[{"formulas":[{"alias":"Cloud Spending","formula":"query1 / 2"}],"queries":[{"data_source":"cloud_cost","name":"query1","query":"sum:aws.cost.ondemand{*} by {product/servicename}.rollup(sum, 86400)"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"},{"on_right_yaxis":true,"formulas":[{"style":{"palette":"warm","palette_index":6},"alias":"Revenue","formula":"query0 / 300"}],"queries":[{"data_source":"metrics","name":"query0","query":"sum:trace.rack.request.hits{resource_name:shoppingcartcontroller_checkout}.as_count().rollup(sum, daily)"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"dashed","line_width":"thick"},"display_type":"line"}]},"layout":{"x":2,"y":2,"width":6,"height":4}},{"id":533434816498498,"definition":{"title":"Cloud Spending Details","title_size":"16","title_align":"left","time":{"type":"live","unit":"month","value":1},"requests":[{"formulas":[{"formula":"query1 / 2","limit":{"count":500,"order":"desc"}}],"queries":[{"data_source":"cloud_cost","name":"query1","query":"sum:aws.cost.ondemand{*} by {product/servicename}","aggregator":"sum"}],"response_format":"scalar","style":{"palette":"datadog16"}}],"type":"sunburst","legend":{"type":"automatic"}},"layout":{"x":8,"y":2,"width":4,"height":4}},{"id":3378214196906840,"definition":{"title":"Cloud Spending","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_value","requests":[{"formulas":[{"formula":"query1 / 2"}],"queries":[{"data_source":"cloud_cost","name":"query1","query":"sum:aws.cost.ondemand{*}","aggregator":"sum"}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":0,"palette":"white_on_green"}]}],"autoscale":true,"precision":0},"layout":{"x":0,"y":4,"width":2,"height":2}},{"id":4647911514975732,"definition":{"title":"Cloud Cost Ratio","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_value","requests":[{"formulas":[{"formula":"(query1 / 2) / (query2 / 300) * 100","number_format":{"unit":{"label":"%","type":"custom_unit_label"}}}],"queries":[{"data_source":"cloud_cost","name":"query1","query":"sum:aws.cost.ondemand{*}","aggregator":"sum"},{"data_source":"metrics","name":"query2","query":"sum:trace.rack.request.hits{resource_name:shoppingcartcontroller_checkout}.as_count().rollup(sum, daily)","aggregator":"sum"}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":15,"palette":"white_on_yellow"}]}],"autoscale":false,"precision":0,"timeseries_background":{"type":"area","yaxis":{"include_zero":false}}},"layout":{"x":0,"y":6,"width":2,"height":2}},{"id":1321198250446220,"definition":{"title":"Cloud Cost Ratio relative to Revenu","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{"type":"live","unit":"month","value":1},"type":"timeseries","requests":[{"formulas":[{"alias":"%","formula":"(query1 / 2) / (query2 / 300) * 100"}],"queries":[{"data_source":"cloud_cost","name":"query1","query":"sum:aws.cost.ondemand{*}.rollup(sum, 86400)"},{"data_source":"metrics","name":"query2","query":"sum:trace.rack.request.hits{resource_name:shoppingcartcontroller_checkout}.as_count().rollup(sum, daily)"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":2,"y":6,"width":10,"height":2}}]},"layout":{"x":0,"y":0,"width":12,"height":9}},{"id":785582272608532,"definition":{"title":"EC2&Containers Utilization","background_color":"vivid_orange","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":8476052728337220,"definition":{"title":"EC2)Max UserCPU<50% / Min Usable MEM>50% / NOT in Auto Scaling Group (DOWN Sizing Recommended)","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_table","requests":[{"queries":[{"name":"query_key","data_source":"metrics","query":"max:system.cpu.user{!aws_autoscaling_groupname:*} by {host}.rollup(max)","aggregator":"max"},{"name":"query1","data_source":"metrics","query":"min:system.mem.pct_usable{!aws_autoscaling_groupname:*} by {host}.rollup(min)","aggregator":"min"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"asc"}]},"formulas":[{"alias":"% User CPU","conditional_formats":[{"comparator":"<","value":50,"palette":"white_on_yellow"}],"cell_display_mode":"bar","formula":"query_key"},{"alias":"% Usable Memory","conditional_formats":[{"comparator":">","value":0.5,"palette":"white_on_yellow"}],"cell_display_mode":"bar","formula":"query1"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":0,"width":12,"height":4}},{"id":2864647867425784,"definition":{"title":"Containers)Max CPU Usage 30% / Max Memory Usage","title_size":"16","title_align":"left","time":{"live_span":"1w"},"type":"query_table","requests":[{"queries":[{"name":"query_key","data_source":"metrics","query":"max:container.cpu.usage{*} by {kube_cluster_name,kube_namespace,kube_container_name}.rollup(max)","aggregator":"max"},{"name":"query1","data_source":"metrics","query":"max:kubernetes.cpu.requests{*} by {kube_cluster_name,kube_namespace,kube_container_name}.rollup(max)","aggregator":"max"},{"name":"query2","data_source":"metrics","query":"max:kubernetes.memory.usage{*} by {kube_cluster_name,kube_namespace,kube_container_name}.rollup(max)","aggregator":"max"},{"name":"query3","data_source":"metrics","query":"max:kubernetes.memory.requests{*} by {kube_cluster_name,kube_namespace,kube_container_name}.rollup(max)","aggregator":"max"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"asc"}]},"formulas":[{"conditional_formats":[{"comparator":"<","value":30000000000,"palette":"white_on_yellow"}],"cell_display_mode":"bar","alias":"Max CPU Usage / Requested","number_format":{"unit":{"type":"canonical_unit","unit_name":"percent_nano"}},"formula":"query_key / query1 * 100"},{"alias":"Max Memory Usage / Requested","conditional_formats":[{"comparator":"<","value":30,"palette":"white_on_yellow"}],"cell_display_mode":"bar","formula":"query2 / query3 * 100"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":4,"width":12,"height":5}}]},"layout":{"x":0,"y":9,"width":12,"height":10}},{"id":4162446091634840,"definition":{"title":"AWS Managed Service","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":6469803197258550,"definition":{"title":"RDS instances with 0 connections in the past 7 days","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":2},"type":"query_table","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"max:aws.rds.database_connections{cloud_provider:aws} by {host}","aggregator":"max"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"asc"}]},"formulas":[{"alias":"Max Connection","conditional_formats":[{"comparator":"=","value":0,"palette":"white_on_red"}],"cell_display_mode":"number","formula":"query1"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":0,"width":12,"height":3}},{"id":2987249673728070,"definition":{"title":"Network ELB Processed Bytes SUM for the past 7 days","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_table","requests":[{"queries":[{"name":"query_key","data_source":"metrics","query":"sum:aws.networkelb.processed_bytes{*} by {host,name}.rollup(sum)","aggregator":"avg"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"asc"}]},"formulas":[{"alias":"Processed Bytes","conditional_formats":[{"comparator":"=","value":0,"palette":"white_on_red"}],"cell_display_mode":"bar","formula":"query_key"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":3,"width":12,"height":3}},{"id":5523099890639908,"definition":{"title":"Unused NAT Gateway","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_table","requests":[{"queries":[{"name":"query_key","data_source":"metrics","query":"sum:aws.natgateway.bytes_out_to_destination{*} by {natgatewayid,name}.rollup(sum)","aggregator":"avg"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"asc"}]},"formulas":[{"alias":"Bytes out to Destination","conditional_formats":[{"comparator":"=","value":0,"palette":"white_on_red"}],"cell_display_mode":"bar","formula":"query_key"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":6,"width":12,"height":3}},{"id":6954072726158262,"definition":{"title":"Unmounted EBS","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_table","requests":[{"response_format":"scalar","queries":[{"name":"query2","data_source":"metrics","query":"sum:aws.ebs.status.ok{!device:fs*,!attachment-status:attached} by {aws_account,volume-id,size,status}","aggregator":"last"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"number","conditional_formats":[{"comparator":">","palette":"white_on_red","value":0}],"formula":"query2"}]}]},"layout":{"x":0,"y":9,"width":12,"height":3}},{"id":4114277484130460,"definition":{"title":"Legacy EC2 Instance (Recommend upgrade from T2 to T3)","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.ec2.host_ok{instance-type:t2*} by {instance-type,name,instance_id,team}","aggregator":"avg"}],"response_format":"scalar","text_formats":[[{"match":{"type":"contains","value":"t2"},"palette":"white_on_yellow"}]],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"bar","alias":"T3변경 대상","formula":"query1"}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":12,"width":6,"height":3}},{"id":5201984854242888,"definition":{"title":"Recommend upgrading from GP2 to GP3 / Check Read/Write OPS trend","title_size":"16","title_align":"left","time":{"type":"live","unit":"week","value":1},"type":"query_table","requests":[{"queries":[{"name":"query_key","data_source":"metrics","query":"sum:aws.ebs.volume_read_ops{*} by {volume-id,volume-type}.rollup(sum)","aggregator":"avg"},{"name":"query1","data_source":"metrics","query":"sum:aws.ebs.volume_write_ops{*} by {volume-id,volume-type}.rollup(sum).as_count()","aggregator":"avg"}],"response_format":"scalar","text_formats":[[],[{"match":{"type":"is","value":"gp2"},"palette":"white_on_yellow"}]],"sort":{"count":500,"order_by":[{"type":"formula","index":2,"order":"asc"}]},"formulas":[{"alias":"Read Operations","cell_display_mode":"bar","formula":"query_key"},{"alias":"Write Operations","cell_display_mode":"bar","formula":"query1"},{"alias":"Read/Write","formula":"query_key + query1","conditional_formats":[{"comparator":"=","value":0,"palette":"white_on_red"}]}]}],"has_search_bar":"auto"},"layout":{"x":6,"y":12,"width":6,"height":3}}]},"layout":{"x":0,"y":19,"width":12,"height":16}},{"id":7319255435208732,"definition":{"title":"그외 서비스 Utilization","background_color":"gray","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":8120164575879916,"definition":{"title":"Serverless Usage Status","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"name":"query1","data_source":"metrics","query":"avg:aws.lambda.memorysize{runtime:*} by {aws_account,functionname,architecture,runtime}","aggregator":"avg"},{"name":"query2","data_source":"metrics","query":"avg:aws.lambda.duration{runtime:*} by {aws_account,functionname,architecture,runtime}","aggregator":"avg"},{"name":"query3","data_source":"metrics","query":"sum:aws.lambda.invocations{runtime:*} by {aws_account,functionname,architecture,runtime}.as_count()","aggregator":"sum"}],"sort":{"count":500,"order_by":[{"type":"formula","index":3,"order":"desc"}]},"formulas":[{"alias":"Memory Size","formula":"query1"},{"alias":"Ave Running Time","formula":"default_zero(query2)"},{"alias":"Total Request ","formula":"query3"},{"alias":"Estimate","formula":"query1 / 128 * 2.1e-9 * default_zero(query2) * query3"}]}],"has_search_bar":"always"},"layout":{"x":0,"y":0,"width":6,"height":4}},{"id":2678125537513294,"definition":{"title":"RDS 현황(1% 미만 빨간색, 40% 미만 노란색 표기)","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"name":"query1","data_source":"metrics","query":"max:aws.rds.cpuutilization{cloud_provider:aws} by {aws_account,host,dbinstanceclass}","aggregator":"max"},{"name":"query2","data_source":"metrics","query":"min:aws.rds.freeable_memory{cloud_provider:aws} by {aws_account,host,dbinstanceclass}","aggregator":"min"},{"name":"query3","data_source":"metrics","query":"max:aws.rds.database_connections{cloud_provider:aws} by {aws_account,host,dbinstanceclass}","aggregator":"max"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"asc"}]},"formulas":[{"alias":"최대 CPU 사용률","conditional_formats":[{"comparator":"<","palette":"white_on_red","value":1},{"comparator":"<","palette":"white_on_yellow","value":40}],"formula":"query1"},{"alias":"메모리 가용량","formula":"query2"},{"alias":"최대 커넥션 수","formula":"query3"}]}]},"layout":{"x":6,"y":0,"width":6,"height":4}},{"id":6679221850111868,"definition":{"title":"DynamoDB Status","title_size":"13","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"max:aws.dynamodb.provisioned_read_capacity_units{name:*} by {aws_account,name}","aggregator":"avg"},{"data_source":"metrics","name":"query2","query":"max:aws.dynamodb.provisioned_write_capacity_units{name:*} by {aws_account,name}","aggregator":"avg"},{"data_source":"metrics","name":"query3","query":"max:aws.dynamodb.consumed_read_capacity_units{name:*} by {aws_account,name}","aggregator":"avg"},{"data_source":"metrics","name":"query4","query":"max:aws.dynamodb.consumed_write_capacity_units{name:*} by {aws_account,name}","aggregator":"avg"}],"sort":{"count":500,"order_by":[{"type":"formula","index":4,"order":"asc"}]},"formulas":[{"alias":"Provisioned Read Unit","formula":"query1"},{"alias":"Provisioned Write Unit","formula":"query2"},{"alias":"Max Read Unit","formula":"query3"},{"alias":"Max Write Unit","formula":"query4"},{"alias":"Read Unit Usage","conditional_formats":[{"comparator":"=","palette":"white_on_red","value":0},{"comparator":"<","palette":"white_on_yellow","value":40}],"formula":"query3 / query1 * 100"},{"alias":"Write Unit Usage","conditional_formats":[{"comparator":"=","palette":"white_on_red","value":0},{"comparator":"<","palette":"white_on_yellow","value":40}],"formula":"query4 / query2 * 100"}]}]},"layout":{"x":0,"y":4,"width":6,"height":4}},{"id":1048284395264812,"definition":{"title":"ElastiCache Status","title_size":"16","title_align":"left","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"max:aws.elasticache.cpuutilization{*} by {name}","data_source":"metrics","name":"query1","aggregator":"max"},{"query":"max:aws.elasticache.database_memory_usage_percentage{*} by {name}","data_source":"metrics","name":"query2","aggregator":"max"},{"query":"max:aws.elasticache.freeable_memory{*} by {name}","data_source":"metrics","name":"query3","aggregator":"max"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"asc"}]},"formulas":[{"alias":"Max CPU","conditional_formats":[{"comparator":"<","palette":"white_on_red","value":1},{"comparator":"<","palette":"white_on_red","value":40}],"cell_display_mode":"number","formula":"query1"},{"alias":"Max Memory ","conditional_formats":[{"comparator":"<","palette":"white_on_red","value":1},{"comparator":"<","palette":"white_on_yellow","value":40}],"formula":"query2"},{"conditional_formats":[{"comparator":"<","palette":"white_on_red","value":1},{"comparator":"<","palette":"white_on_yellow","value":40}],"alias":"Available Memory","formula":"query3"}]}]},"layout":{"x":6,"y":4,"width":6,"height":4}}]},"layout":{"x":0,"y":0,"width":12,"height":9,"is_column_break":true}}],"template_variables":[],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed"}